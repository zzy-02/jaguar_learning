### 1. BDF号查询方法对比
BDF号（Bus-Device-Function）是用于唯一标识计算机系统中PCI设备的编号。以下是几种常用的查询BDF号的方法：
```bash
lspci -D | grep 1f53:3b20       # 推荐0001:c3:00.0 Ethernet controller: Device 1f53:3b20
devlink dev show                # 实操时查询可以用这个，固件 / devlink
lshw -businfo                   # 列出所有总线设备信息，写文档时用
ls /sys/bus/pci/devices/        # 直接查看/sys文件系统中的PCI设备目录，底层 / 自动化
ethtool -i eth0                 # 查看指定网口的驱动信息，从中可以找到对应网口的BDF号
```

### 2. 固件升级方法对比
固件升级可以通过多种工具和方法进行，以下是两种常用的升级方法对比：
- **devlink 升级固件**
  - 适用场景：带内升级、操作系统内、驱动参与、走 PCIe / netlink
  - 优点：不需要物理连接，升级过程可以通过网络进行，适合远程管理
  - 缺点：依赖操作系统和驱动的支持，升级过程中可能会受到系统状态的影响
```bash
# 实操举例
# 先将升级文件拷贝到固件目录，这里升级文件的类型是plmd、pkg、bin等
# 然后使用 devlink 命令进行升级
cp jm800_nic_fw_crdca_2x200g_2.3.4_2.0.1.B120_251225.pldm /lib/firmware
devlink dev flash pci/0001:c3:00.0 file jm800_nic_fw_crdca_2x200g_2.3.4_2.0.1.B120_251225.pldm

cp jm800_nic_nvm_crdca_2x200g_2.3.4_2.0.1.B120_251225_pkg.pldm /lib/firmware
devlink dev flash pci/0001:c3:00.0 file jm800_nic_nvm_crdca_2x200g_2.3.4_2.0.1.B120_251225_pkg.pldm

cp jm800_rcw_nic_cxaca_2.3.4_2.0.1.B120_251225_pkg.pldm /lib/firmware
devlink dev flash pci/0001:c3:00.0 file jm800_rcw_nic_cxaca_2.3.4_2.0.1.B120_251225_pkg.pldm

ipmitool power cycle   # 升级完成后重启设备以使新固件生效
```
- **minicom 升级固件**
  - 适用场景：带外升级、串口直连、不依赖操作系统和驱动
  - 优点：不受操作系统状态影响，适合在系统无法启动时进行升级
  - 缺点：需要物理连接，升级过程较为复杂，适合现场操作
```bash
# 实操举例
# 使用 minicom 连接到设备的串口，进入升级模式  
minicom -D /dev/ttyACM0 -b 115200   # ACM0->SCP
>uart set rate 2000000
>show version             # 查看当前SCP版本信息
minicom -D /dev/ttyACM0 -b 2000000
>update baseflash
>update accflash
>reboot
minicom -D /dev/ttyACM1         # ACM1->IMU
>disaplay version        # 查看当前IMU版本信息

ipmitool power cycle   # 升级完成后重启设备以使新固件生效

```

### 3. jmnd_tool常用命令
参考https://space.jaguarmicro.com/pages/viewpage.action?pageId=224907384
```bash
jmnd_tool -D 0000:52:00.0 help               # 显示所有命令信息
```

### 4. tcpdump抓包常用命令
tcpdump是一个强大的网络数据包分析工具，常用于网络故障排除和安全分析、验证是否有数据包通过网卡发送和接收等场景。以下是一些常用的tcpdump命令示例：
```bash
# 在命名空间ns1中抓取enp95s0接口上的ICMP数据包，并显示数字格式的IP地址和端口号
ip netns exec ns1 tcpdump -i enp95s0 icmp -nn  
# 在命名空间ns1中抓取enp95s0接口上的ARP数据包，并显示数字格式的IP地址和端口号
ip netns exec ns1 tcpdump -i enp95s0 arp -nn 
# 在命名空间ns1中抓取enp95s0接口上目的端口为5201的TCP数据包，并显示数字格式的IP地址和端口号
ip netns exec ns1 tcpdump -i enp95s0 tcp port 5201 -nn
tcpdump -i enp95s0 host 192.0.0.1 -nn  # 抓取enp95s0接口上与IP地址192.0.0.1相关的所有数据包，并显示数字格式的IP地址和端口号
tcpdump -i enp95s0 host 192.0.0.1 and port 5201 -nn  # 抓取enp95s0接口上与IP地址192.0.0.1相关且端口为5201的所有数据包，并显示数字格式的IP地址和端口号
tcpdump -i enp95s0 dst host 192.0.0.1 -nn # 抓取enp95s0接口上目的地址为192.0.0.1的所有数据包，并显示数字格式的IP地址和端口号
tcpdump -i enp95s0 src host 192.0.0.1 -nn # 抓取enp95s0接口上源地址为192.0.0.1的所有数据包，并显示数字格式的IP地址和端口号
```
![](图片\Tcpdump输出信息.png)

### 5. 常用的环境信息查询命令
```bash
uname -a                  # 查看系统内核版本信息
cat /etc/os-release       # 查看操作系统版本信息
lscpu                     # 查看CPU信息,包括Architecture、Vendor ID、Socket / Core / NUMA node等
cat /proc/cmdline         # 查看内核启动参数
uname -r                  # 查看内核版本
uname -m                  # 查看系统架构

lsmod                     # 查看已加载的内核模块
lspci -vvv                # 查看PCI设备的详细信息

dmesg                  # 查看内核环形缓冲区日志

lspci -s 0000:bf:00.0 -vvv # 查看指定PCI设备的详细信息
numactl -H              # 查看NUMA节点信息

```
### 6. numa、pci设备、CPU
```bash
numactl -H              # 查看NUMA节点信息
grep Huge /proc/meminfo   # 查看大页内存使用情况
ls /sys/devices/system/node/node*/hugepages/   # 查看各NUMA节点下的大页内存信息

ls /sys/devices/system/node/ # 查看NUMA节点目录结构
cat /sys/bus/pci/devices/0000:bf:00.0/numa_node  # 查看指定PCI设备所属的NUMA节点
cat /sys/class/net/enp95s0/device/numa_node  # 查看指定网口所属的NUMA节点
cat /sys/devices/system/node/node0/cpulist  # 查看NUMA节点0上的CPU列表

```
